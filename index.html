<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ó–≤–æ–Ω–∏–ª–∫–∞ –ö–∞–ø–ª–∏–Ω—Å–∫–æ–≥–æ</title>

  <!--
    App meta
    - PWA, Social, SEO metadata used by search engines and link previews.
    - Keep `theme-color` in sync with the top-level background color.
  -->
  <meta name="theme-color" content="#0b0f14">
  <meta name="description" content="–ü—Ä–æ—Å—Ç–æ–π –∏ –Ω–∞–¥—ë–∂–Ω—ã–π –≤–µ–±‚Äë–∑–≤–æ–Ω–æ–∫ —á–µ—Ä–µ–∑ WebRTC. –†–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –≤ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã—Ö —Å–µ—Ç—è—Ö (TURN 443/TCP).">
  <meta property="og:type" content="website">
  <meta property="og:title" content="–ó–≤–æ–Ω–∏–ª–∫–∞ –ö–∞–ø–ª–∏–Ω—Å–∫–æ–≥–æ">
  <meta property="og:description" content="–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –≥–æ–ª–æ—Å–æ–≤—ã–µ –∑–≤–æ–Ω–∫–∏ –ø—Ä—è–º–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ. –†–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –ø—Ä–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞—Ö WhatsApp/Telegram.">
  <meta property="og:url" content="https://call.zababba.com/">
  <meta property="og:image" content="https://call.zababba.com/icons/web-app-manifest-512x512.png">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="–ó–≤–æ–Ω–∏–ª–∫–∞ –ö–∞–ø–ª–∏–Ω—Å–∫–æ–≥–æ">
  <meta name="twitter:description" content="–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –≥–æ–ª–æ—Å–æ–≤—ã–µ –∑–≤–æ–Ω–∫–∏ –ø—Ä—è–º–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ. –†–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –ø—Ä–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞—Ö WhatsApp/Telegram.">

  <!--
    Icons and manifest
    - Icons are served from /public/icons via Vite copying assets to the root.
    - Keep `manifest.webmanifest` and listed icon sizes consistent with /public/icons.
  -->
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <link rel="manifest" href="/manifest.webmanifest">

  <!--
    Minimal in-page CSS
    - Kept inline to avoid FOUC and reduce early network waterfalls.
    - Consider extracting to a CSS file if this grows substantially.
  -->
  <style>
    :root{
      --bg:#0b0f14;--fg:#e8f0fe;--muted:#9fb0c2;--card:#111826;
      --stroke:#1e293b;--accent:#22c55e;--accent2:#3b82f6;--err:#ef4444;--warn:#f59e0b;
      --gap:12px
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:var(--bg);color:var(--fg);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,'Noto Sans',sans-serif}
    .wrap{max-width:960px;margin:0 auto;padding:20px}
    h1{font-size:22px;margin:6px 0 16px}
    .card{background:var(--card);border:1px solid var(--stroke);border-radius:16px;padding:16px;box-shadow:0 6px 24px rgba(0,0,0,.35);margin-bottom:16px}
    .row{display:flex;gap:var(--gap);flex-wrap:wrap;align-items:center}
    .row>*{flex:1 1 220px}
    .controls .row>*{flex:1 1 260px}
    button{appearance:none;border:0;background:var(--accent2);color:#fff;padding:14px 16px;border-radius:14px;font-weight:700;cursor:pointer;box-shadow:0 6px 16px rgba(59,130,246,.35);transition:transform .04s ease}
    button:active{transform:translateY(1px)}
    button.primary{background:var(--accent)}
    button.warn{background:var(--warn);color:#111}
    button.ghost{background:#152030;color:#cfe0f6;border:1px solid #22324a;box-shadow:none}
    button:disabled{opacity:.55;cursor:not-allowed;box-shadow:none}
    .muted{color:var(--muted);font-size:13px}
    .pill{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:999px;background:#0f172a;border:1px solid #22324a;font-size:12px;color:#cfe0f6}
    audio{width:100%;margin-top:8px}
    .hidden{display:none}
    .ok{color:#22c55e}.warn-txt{color:var(--warn)}.err{color:var(--err)}
    .big{font-size:18px}
    .center{text-align:center}
    .kvs{display:grid;grid-template-columns:180px 1fr;gap:6px 10px}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}
    #logList{max-height:220px;overflow:auto;background:#0b1220;border:1px solid #253041;border-radius:12px;padding:8px}
    #logList .it{font-size:12px;border-bottom:1px dashed #263445;padding:4px 0}
    .sep{height:1px;background:#22324a;margin:10px 0}
    .btnbar{display:flex;flex-wrap:wrap;gap:var(--gap)}
    .btnbar > *{flex:1 1 240px}
    /* Make top action buttons full width and pinned to full row */
    .topline { display:grid; grid-template-columns: 1fr auto; gap: var(--gap); align-items:center; }
    .topline .btnbar {
      grid-column: 1 / -1;   /* span across both columns */
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: var(--gap);
      width: 100%;
    }
    .topline .btnbar > button { width: 100%; }
    .badge{display:inline-block;padding:4px 8px;border-radius:8px;background:#102035;border:1px solid #20314a;color:#b6c7da;font-size:12px}
    dialog{border:1px solid var(--stroke);background:var(--card);color:var(--fg);border-radius:16px;max-width:720px;width:92%;padding:0;box-shadow:0 10px 40px rgba(0,0,0,.55)}
    dialog::backdrop{background:rgba(0,0,0,.6)}
    .dlg-head{display:flex;justify-content:space-between;align-items:center;padding:14px 16px;border-bottom:1px solid var(--stroke)}
    .dlg-body{padding:16px;max-height:min(70vh,560px);overflow:auto}
    .dlg-body h3{margin:.2em 0 .6em;font-size:18px}
    .list {margin:0;padding-left:18px;color:var(--fg)}
    .list li{margin:.3em 0}
    .link{color:#99c0ff;text-decoration:none}
    /* .topline rule replaced above */
    .topline .spacer{display:none}
    .status-area{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .status-note{min-width:260px}
    /* Video circle + dock */
    #videoWrap{ display:none; width:min(56vh,56vw); aspect-ratio:1/1; margin:16px auto 0; border-radius:50%; overflow:hidden; background:#0b1220; border:1px solid var(--stroke) }
    #videoWrap video{ width:100%; height:100%; object-fit:cover }
    #videoDock{ display:flex; justify-content:center; gap:12px; margin:10px auto 0; }
    #videoDock .ghost{ min-width:140px }
    /* RTL support */
    html[dir="rtl"] body{ text-align:right; }
    html[dir="rtl"] .wrap{ direction:rtl; }
    html[dir="rtl"] h1,
    html[dir="rtl"] p,
    html[dir="rtl"] label { text-align:right; }
    html[dir="rtl"] .list{ direction:rtl; padding-right:18px; padding-left:0; }
    html[dir="rtl"] .pill{ direction:rtl; }
    /* i18n language switch - compact */
    .lang-switch{ display:flex; gap:6px; margin-left:auto }
    .lang-switch .lang-btn{
      padding:6px 10px; font-size:12px;
      background:#152030; color:#cfe0f6;
      border:1px solid #22324a; border-radius:10px; box-shadow:none
    }
    .lang-switch .lang-btn.active{ background:#22324a }
  </style>
</head>
<body>
  <!--
    Main application layout:
    - Top status bar + language switch + quick actions
    - Controls panel (call/answer/hangup + invite sharing)
    - Debug panel (hidden by default)
  -->
  <div class="wrap">
    <h1 data-i18n="app.brand">üìû –ó–≤–æ–Ω–∏–ª–∫–∞ –ö–∞–ø–ª–∏–Ω—Å–∫–æ–≥–æ</h1>

    <!-- Status and language switch card -->
    <div class="card">
      <div class="topline">
        <div class="status-area">
          <span class="pill"><span data-i18n="label.status">–°—Ç–∞—Ç—É—Å:</span> <span id="status" aria-live="polite">–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è‚Ä¶</span></span>
          <span class="badge" id="roleBadge" data-i18n="role.caller">–†–µ–∂–∏–º: –∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä</span>
        </div>
        <div class="spacer"></div>
        <div id="lang-switch" class="lang-switch"></div>
        <div class="btnbar">
          <button id="btnHowTo" class="ghost" data-i18n="menu.howto">üìò –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è</button>
          <button id="btnAbout" class="ghost" data-i18n="menu.about">‚ÑπÔ∏è –û –ø—Ä–æ–≥—Ä–∞–º–º–µ</button>
          <button id="btnDebug" class="ghost" data-i18n="menu.debug">üõ†Ô∏è –û—Ç–ª–∞–¥–∫–∞</button>
        </div>
      </div>

      <div id="note" class="muted status-note" data-i18n="diag.checking_env">–ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–∫—Ä—É–∂–µ–Ω–∏–µ‚Ä¶</div>

      <!-- Remote audio sink for incoming RTP audio track -->
      <audio id="remoteAudio" autoplay playsinline hidden></audio>

      <!-- LED level bars -->
      <div id="ledBars" style="display:none;gap:4px;align-items:flex-end;height:80px;width:33.33%;margin:8px auto 0">
        <div class="bar" style="flex:1;background:#22c55e;border-radius:4px 4px 0 0;height:20%"></div>
        <div class="bar" style="flex:1;background:#3b82f6;border-radius:4px 4px 0 0;height:40%"></div>
        <div class="bar" style="flex:1;background:#f59e0b;border-radius:4px 4px 0 0;height:60%"></div>
        <div class="bar" style="flex:1;background:#ef4444;border-radius:4px 4px 0 0;height:30%"></div>
      </div>
      <div id="callTimer" class="muted" style="display:none;text-align:center;margin-top:6px"></div>
    </div>

    <!-- Controls: call start/answer/hangup and share link -->
    <div class="card controls">
      <div class="btnbar">
        <button id="btnCall"   class="primary big" data-i18n="btn.start_call">üìû –ù–∞—á–∞—Ç—å –∑–≤–æ–Ω–æ–∫</button>
        <button id="btnAnswer" class="big hidden" data-i18n="btn.answer_call">‚úÖ –û—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –∑–≤–æ–Ω–æ–∫</button>
        <button id="btnHang"   class="warn big" disabled data-i18n="btn.hangup">üõë –ó–∞–≤–µ—Ä—à–∏—Ç—å</button>
      </div>
      <!-- Video circle (shown only in video mode) -->
      <div id="videoWrap">
        <video id="remoteVideo" autoplay playsinline></video>
      </div>
      <!-- Neutral dock for video controls -->
      <div id="videoDock" class="btnbar" style="justify-content:center">
        <button id="btnVideoToggle" class="ghost" data-i18n="video.toggle">üé• –í–∏–¥–µ–æ</button>
        <button id="btnCamFlip" class="ghost" data-i18n="video.flip">üîÑ –ö–∞–º–µ—Ä–∞</button>
        <button id="btnMicToggle" class="ghost" data-i18n="video.mic">üéôÔ∏è –ú–∏–∫—Ä–æ—Ñ–æ–Ω</button>
      </div>

      <div id="shareWrap" class="hidden" style="margin-top:var(--gap)">
        <div class="btnbar">
          <button id="btnNativeShare" class="primary" data-i18n="btn.share">üì§ –ü–æ–¥–µ–ª–∏—Ç—å—Å—è</button>
          <button id="btnCopy"        class="" data-i18n="btn.copy_link">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É</button>
        </div>
        <div style="margin-top:8px">
          <label class="muted" data-i18n="label.invite_link">–°—Å—ã–ª–∫–∞ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è</label>
          <input id="shareLink" type="text" readonly value="(–±—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ)" style="width:100%;background:#0b1220;color:var(--fg);border:1px solid #253041;border-radius:12px;padding:10px;font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace">
          <div class="muted" data-i18n="hint.send_invite_whatsapp">–û—Ç–ø—Ä–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫—É (–≤ WhatsApp ‚Üí ¬´–û—Ç–∫—Ä—ã—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ¬ª).</div>
        </div>
      </div>
    </div>

    <!-- Debug block (hidden by default). Populate via JS when "Debug" is enabled. -->
    <div id="debugBlock" class="card hidden">
      <h3 style="margin-top:0" data-i18n="debug.title">–û—Ç–ª–∞–¥–∫–∞</h3>
      <div class="kvs">
        <div class="muted" data-i18n="debug.protocol">–ü—Ä–æ—Ç–æ–∫–æ–ª</div>          <div id="dbgProto"  class="mono">‚Äî</div>
        <div class="muted">Secure context</div>    <div id="dbgSecure" class="mono">‚Äî</div>
        <div class="muted">getUserMedia</div>      <div id="dbgGUM"    class="mono">‚Äî</div>
        <div class="muted">RTCPeerConnection</div> <div id="dbgPC"     class="mono">‚Äî</div>
        <div class="muted">User-Agent</div>        <div id="dbgUA"     class="mono">‚Äî</div>
        <div class="muted" data-i18n="diag.inapp_browser">In-App –±—Ä–∞—É–∑–µ—Ä</div>    <div id="dbgInApp"  class="mono">‚Äî</div>
      </div>
      <div class="sep"></div>
      <div class="row">
        <button id="btnCopyDiag" data-i18n="btn.copy_report">üß∞ –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—á—ë—Ç</button>
        <div class="muted" data-i18n="debug.copy_and_send">–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –ø—Ä–∏—à–ª–∏—Ç–µ –Ω–∞–º –ø—Ä–∏ –æ—Ç–ª–∞–¥–∫–µ.</div>
      </div>
      <div id="logList" class="mono" aria-live="polite"></div>
    </div>
  </div>

  <!-- Dialog: How-To guide -->
  <dialog id="dlgHowTo">
    <div class="dlg-head">
      <strong data-i18n="menu.howto">üìò –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è</strong>
      <button class="ghost" onclick="this.closest('dialog').close()">‚úñ</button>
    </div>
    <div class="dlg-body">
      <h3 data-i18n="howto.title">–ö–∞–∫ –ø–æ–∑–≤–æ–Ω–∏—Ç—å</h3>
      <ol class="list">
        <li><span data-i18n="howto.step_site">–ó–∞–π–¥–∏—Ç–µ –Ω–∞ —Å–∞–π—Ç</span> <a class="link" href="https://call.zababba.com" target="_blank" rel="noopener">call.zababba.com</a>.</li>
        <li data-i18n="howto.step_start">–ù–∞–∂–º–∏—Ç–µ ¬´–ù–∞—á–∞—Ç—å –∑–≤–æ–Ω–æ–∫¬ª –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫—É —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å—Å—ã–ª–∫—É.</li>
        <li data-i18n="howto.step_answer">–ü–æ–ø—Ä–æ—Å–∏—Ç–µ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞ –æ—Ç–∫—Ä—ã—Ç—å —Å—Å—ã–ª–∫—É –≤–æ –≤–Ω–µ—à–Ω–µ–º –±—Ä–∞—É–∑–µ—Ä–µ –∏ –Ω–∞–∂–∞—Ç—å ¬´–û—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –∑–≤–æ–Ω–æ–∫¬ª.</li>
        <li data-i18n="howto.step_end">–ü–æ—Å–ª–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –æ—Å—Ç–∞–Ω–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–Ω–æ–ø–∫–∞ ¬´–ó–∞–≤–µ—Ä—à–∏—Ç—å¬ª.</li>
      </ol>

      <h3 data-i18n="howto.under_the_hood">–ß—Ç–æ –ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º</h3>
      <p data-i18n="howto.under_the_hood"></p>

      <h3 data-i18n="howto.if_no_connect">–ï—Å–ª–∏ –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è</h3>
      <ul class="list">
        <li data-i18n="howto.tip_open_external">–û—Ç–∫—Ä–æ–π—Ç–µ —Å—Å—ã–ª–∫—É –≤–æ –≤–Ω–µ—à–Ω–µ–º –±—Ä–∞—É–∑–µ—Ä–µ (–≤ WhatsApp/Telegram ‚Üí ¬´–û—Ç–∫—Ä—ã—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ¬ª).</li>
        <li data-i18n="howto.tip_mic">–†–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É.</li>
        <li data-i18n="howto.tip_https">–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å–∞–π—Ç –æ—Ç–∫—Ä—ã—Ç –ø–æ HTTPS.</li>
      </ul>
    </div>
  </dialog>

  <!-- Dialog: About app -->
  <dialog id="dlgAbout">
    <div class="dlg-head">
      <strong data-i18n="menu.about">‚ÑπÔ∏è –û –ø—Ä–æ–≥—Ä–∞–º–º–µ</strong>
      <button class="ghost" onclick="this.closest('dialog').close()">‚úñ</button>
    </div>
    <div class="dlg-body">
      <p data-i18n="about.lead">–ó–≤–æ–Ω–∏–ª–∫–∞ –ö–∞–ø–ª–∏–Ω—Å–∫–æ–≥–æ ‚Äî –º–∞–ª–µ–Ω—å–∫–∏–π –∏ —Å–∫—Ä–æ–º–Ω—ã–π –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ø—Ä–æ–µ–∫—Ç-—Ö–æ–±–±–∏. –¶–µ–ª—å ‚Äî –ø—Ä–æ—Å—Ç–∞—è –∏ –Ω–∞–¥—ë–∂–Ω–∞—è –≥–æ–ª–æ—Å–æ–≤–∞—è —Å–≤—è–∑—å –ø—Ä—è–º–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ.</p>
      <p data-i18n="about.privacy1">–†–∞–∑–≥–æ–≤–æ—Ä—ã –Ω–µ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –∏ –Ω–∏–∫–æ–º—É –Ω–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è.</p>
      <p data-i18n="about.privacy2">–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –∑–∞–ø–∏—Å—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞.</p>
      <p><span data-i18n="about.contact_label">–°–≤—è–∑–∞—Ç—å—Å—è —Å–æ –º–Ω–æ–π:</span> <a class="link" href="mailto:mail@zababba.com">mail@zababba.com</a></p>
    </div>
  </dialog>

  <!--
    Runtime configuration
    - /public/config.js populates `window.__APP_CONFIG__` with server URLs.
    - The onerror fallback ensures sane defaults if config.js fails to load.
  -->
  <script src="/config.js"
          onerror="window.__APP_CONFIG__={SERVER_URL:'https://call.zababba.com/signal',WS_URL:'wss://call.zababba.com/ws'}"></script>

  <!--
    Logging shim
    - Provides a stable `logT(level, key, extras)` until i18next/UI logger is ready.
    - Avoids runtime errors if logging is called too early during bootstrap.
  -->
  <script>
    window.logT ||= function(level, key, extras){
      try {
        const msg = (window.i18next && i18next.t) ? i18next.t(key, extras) : (key||'');
        (window.addLog ? window.addLog : console.log)(level||'info', msg);
      } catch(e) {}
    };
  </script>

  <!--
    Application entrypoint
    - We use a single ES module to bootstrap i18n, signaling, and WebRTC logic.
    - Historical /public/js/* tags were removed; Vite handles module graph bundling.
  -->
  <script type="module" src="/src/main.js"></script>

  <!--
    Service Worker registration
    - Registers /sw.js on window load.
    - Logs registration result to the in-app logger if available.
  -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
          .then(() => { try{ addLog('info','SW registered'); }catch{} })
          .catch((e) => { try{ addLog('error','SW register failed: '+(e.message||e)); }catch{} });
      });
    }
  </script>
</body>
</html>